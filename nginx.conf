events {}

http {
    # Rate limiting global (fuera del server)
    limit_req_zone $binary_remote_addr zone=one:10m rate=5r/s;

    server {
        listen 80;
        server_name foreverlivingasturias.com foreverlivingasturias.duckdns.org;

        # Bloqueo de bots agresivos
        if ($http_user_agent ~* (AhrefsBot|SemrushBot|MJ12bot|DotBot|BLEXBot|DataForSeoBot|YandexBot|PetalBot|Bytespider|Sogou|ZoominfoBot)) {
            return 403;
        }

        # Proxy principal hacia Google Sites
        location / {
            limit_req zone=one burst=10 nodelay;

            proxy_pass https://sites.google.com/view/foreverlivingasturias/;
            proxy_set_header Host sites.google.com;
            proxy_set_header X-Real-IP $remote_addr;

            # Mantener tu dominio en la barra del navegador
            proxy_redirect https://sites.google.com/view/foreverlivingasturias/ /;

            # Evitar que Google Sites bloquee el proxy
            proxy_hide_header X-Frame-Options;
            proxy_hide_header Content-Security-Policy;
        }

        # Servir robots.txt desde Render
        location = /robots.txt {
            root /usr/share/nginx/html;
        }
    }
}


